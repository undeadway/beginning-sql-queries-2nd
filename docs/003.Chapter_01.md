# 第一章 关系型数据库总览

SQL（结构化查询语言，Structured Query Language）让我们可以创建表格（table），执行约束（constraint），以及在一个数据库（database）中操纵（manipulate）数据。在本书中我们将聚焦于那些允许我们通过一定的表达去从数据库中获得我们想要得到的信息的查询功能。这些数据可以是像单价一样的简单数字，可以是不再订阅的读者名单，可以是过去12个月的产品销售总额的计算结果。在本书中我们将通过不同的SQL查询方式来获得相同的结果。  
在开始查询之前，我们必须要复习一下和关系型数据库相关的术语。我们还会研究种数据模型，这是了解某种数据库是如何通过最简洁的方式将它们组合起来的。也就是数据是如何保存，以及它们之间如何关联的。  
这种研究对于准确地了解数据库的底层的设计如何准确表达行为是非常有必要。这不仅仅是说怎么去建立合适的表，也是在说要加上合适的约束，如此一来数据就会保持一致，并且随着数据库的发展保持一致。如果数据库本身的设计有问题，那就算使用了世界上所有的SQL技巧你都无法获得查询的准确的结果。在你开始在项目中着手设计一个新的数据库之前，最好参考一下数据库的设计书[^C0]。

## 介绍数据库的表
简而言之，一个关系型数据库就是一个表[^C1]的集合（set）。所有表所是一张表对应一个实例的良好设计，比如客户、销售额、团队，或者比赛。在书中我们始终会以高尔夫俱乐部为例子对数据库进行说明。所有的表格都会在书中被一一介绍，在附录1中有它们的列表。

## 属性（Attributes）
我们需要在创建表的时候规定这张表所包含的信息。比如成员（Member）表就可能包含名字、地址、联系方式。我们要决定需要哪些信息。比如我们会选择把姓（family name）、名（first name）、首字母（initials）和昵称（preferred name）等信息分开来。这种分离可以让我们更灵活的使用这些数据。比如我们会通过地址联系J.A.Stevens，并在邮件的开头写“亲爱的Jim”。而这些所有被分离出来的部分，就是表的属性。  
我们必须先提供一个名称（比如：姓名、差点（Handicap）[^C2]、生日）和集域（domain）[^C3]或类别（type）。集域是被允许的数据的集合，有些非常普通，有些非常特殊。比如在集域中的字段（column）中存储日期的话应该是个合法日期（所以2月29日只能用于闰年），而当字段存储整数时候则值必需大于0。我们最初的想法是在姓（FalimlyName）属性中可以存放任意字符，但在仔细考虑之后我们需要去确认是否要允许标点符号（大概率会），如果数字被允许（很难说），那就会有最大值和最小值。所有的数据库系统都内置了像文本（text）、数字（integer）、日期（data）这些可供所有字段选用的集域或者类别。比如我们要定义一个叫`CarRegistration`的字段，并规定它的值可以是字母和数字。你甚至不需要去预先定义你想要的类别，所有优秀的数据库都允许设计者在一张表的特定属性上定义约束（constraints）。就像我们会在一张特定的表中定义一个生日属性，可以是到今天为止的日期；或者定义一个差点属性，可以是0到40之间的数字。有些属性可以允许为空，但有些却不允许。  
当我们审视表的时候，属性的名字就是字段的名称，集域或者类别规定了怎么取值。一旦我们完成了表的定义我们就可以一行行地添加数据了。比如我们有一张如图1-1所示的`Member`表，每一行都代表了一名会员（member）。

![Figure 1-1](./../img/Figure_1-1.png)  
图1-1 会员表（Member Table）

## 主键（Primary Key）
关系型数据库最重要的一个特点就是表中的每行数据都应该是唯一的。对于每个属性，在同一张表中不能有两条相同的值。再联想到我们的会员数据，就可以搞清楚为什么唯一约束是如此重要了。像图1-1中所示的那样，我们有两条相同的行比如都叫 Brenda Nolan，我们将没有办法区分它们。我们或许会把队伍和其中一个人绑定却将账单绑定到了另一个人身上，从而产生各种各样的混乱。  
关系型数据库解决唯一性问题的方法是指定一个主键。主键是一个或者一些属性，这样就能保证。

[^C0]: 原书注：For example, you can refer to my other Apress book, Beginning Database Design: From Novice to Professional (New York: Apress, 2012).

[^C1]: 原书注：More correctly, it’s a set of relations. In the body of the book common words such as table and row are used. In Appendix 2 we introduce the more formal vocabulary and notation.

[^C2]: 这里的原词是“Handicap”在高尔夫运动中称为“差点”，是苏格兰人发明的。参阅资料：[百度百科](https://baike.baidu.com/item/handicap/8441761)。

[^C3]: “集域”这个词是我发明的，如果有更好的翻译，望告知。

